---------------------------------------------------------------------------[[//////////////////]]---------------------------------------------------------------------------
function AntiPlayerExploitsCore:OnPlayerDropWeapon(_, _, entity)
    local physObject = entity:GetPhysicsObject()
    if physObject then physObject:EnableMotion() end
    timer.Simple(ProtectionCore.TimeUntilDroppedSWEPRemoved, function() if entity and entity:IsValid() then entity:Remove() end end)
end

---------------------------------------------------------------------------[[//////////////////]]---------------------------------------------------------------------------
function AntiPlayerExploitsCore:EntityTakeDamage(entity, dmgInfo)
    local inflictor = dmgInfo:GetInflictor()
    local attacker = dmgInfo:GetAttacker()
    local validClient = IsValid(entity) and entity:IsPlayer()
    local validAttacker = IsValid(attacker) and attacker:IsPlayer()
    local notSameAttackerAsEnt = attacker ~= entity and dmgInfo:IsFallDamage()
    local infIsProp = inflictor and IsValid(inflictor) and inflictor:isProp()
    if not (validAttacker and validClient) then return end
    if infIsProp then dmgInfo:SetDamage(0) end
    if notSameAttackerAsEnt and not entity:isStaffOnDuty() then entity.LastDamaged = CurTime() end
    if ProtectionCore.CarRagdoll and IsValid(inflictor) and (inflictor:GetClass():lower() == "gmod_sent_vehicle_fphysics_base" or inflictor:GetClass() == "gmod_sent_vehicle_fphysics_wheel") and not IsValid(entity:GetVehicle()) then
        dmgInfo:ScaleDamage(0)
        if not IsValid(entity.liaRagdoll) then entity:setRagdolled(true, 5) end
    end
end

---------------------------------------------------------------------------[[//////////////////]]---------------------------------------------------------------------------
function AntiPlayerExploitsCore:CanPlayerSwitchChar(client, character)
    if not client:isStaffOnDuty() then
        if ProtectionCore.OnDamageCharacterSwitchCooldown and client.LastDamaged and client.LastDamaged > CurTime() - ProtectionCore.OnDamageCharacterSwitchCooldownTimer then return false, "You took damage too recently to switch characters!" end
        if ProtectionCore.CharacterSwitchCooldown and (character:getData("loginTime", 0) + ProtectionCore.CharacterSwitchCooldownTimer) > os.time() then return false, "You are on cooldown!" end
    end
end

---------------------------------------------------------------------------[[//////////////////]]---------------------------------------------------------------------------
function AntiPlayerExploitsCore:CanPlayerJoinClass(client)
    if client:getNetVar("ziptied", false) then
        client:notify("You cannot change classes when you are restrained!")
        return false
    end
end
---------------------------------------------------------------------------[[//////////////////]]---------------------------------------------------------------------------
